### Задание пути в виде URI-схемы
```bash
hdfs://localhost:8020/user/home
```
|Название части URI|Фрагмент|Описание|
|--|--|--|
|scheme|hdfs://|схема|
|authority|localhost:8020|часть авторизации -- название сервера, порт, на котором находится Namenode, может быть указано имя пользователя|
|HDFS path|/user/home|путь в распределенной или локальной файловой системе|

* Local
Указываем `file://` -- схема, а путь -- `/to/path/dir`. Аналогична команде `ls /to/path/dir` локальной файловой системы
 ```bash
hdfs dfs -ls file:///to/path/dir
 ```

* HDFS
Просмотр файлов в распределенной файловой системе HDFS
 ```bash
hdfs dfs -ls hdfs://localhost/to/path/dir
 ```
где `hdfs://` -- схема, а `localhost/to/path/dir` -- расположение namenode, а далее путь к файлам в HDFS.
На сервере:
 ```bash
hdfs dfs -ls hdfs://hadoop-master.vtizi.ru/
 ```
В виртуальной машине:
 ```bash
hdfs dfs -ls hdfs://localhost:8020/
 ```
* `fs.default.name=hdfs://localhost`
Чтобы постоянно не указывать схему и сервер при работе с одной и той же HDFS применяется упрощенный способ доступа к файлам HDFS без схемы и части авторизации. В конфигурации указан специальный параметр, который автоматически будет подставляться в схему
 ```bash
 hdfs dfs -ls /to/path/dir
 ```

### Команды Shell
В HDFS  клиенте реализованы стандартные команды для работы с файловой системой. Называются похоже на команды `bash`(локальной файловой системы). 

Команды:
* похожие на команды `Linux`: `cat, rm, ls, du, ...`;
* специфичные для HDFS операции: `setrep` -- смена фактора репликации;

#### 1. Команда `help` 

получить список всех команд в HDFS-клиенте
```bash
hdfs dfs -help
```
показать информацию по команде:
```bash
hdfs dfs -help <commande_name>
```
#### 2. Команда `ls`

`ls` -- самая популярная команда, выводит листинг директории и статистику файлов. Если запустим команду для определенной директории, то увидим ее содержимое:
* сколько элементов в данной директории `items`
* файлы, которые содержатся в директории
* статистика -- указание прав доступа и типа файла (поддиректории), фактор репликации (у директории -- нет), принадлежность файла (пользователь и группа), время создания.
Параметры команды:
* `-r` -- вывести статистику по поддиректориям
Пример команды:
```bash
hdfs dfs -ls -r /
```
#### 3. Команда `mkdir`
Создает директорию
```bash
hdfs dfs -mkdir /data/new_path
```
#### 4. Команда чтения файлов `cat`
Выводит источник в стандартный поток вывода -- `stdout`.
* вывести весь файл `hdfs dfs -cat /dir/file.txt` -- для больших файлов очень долго и не понятно для чего
* перенаправление потока вывода через каналы **`pipe`** в утилиты *less, head, tail* 
* получить первые 100 строк из файла `hdfs dfs -cat /dir/file.txt | head -n 100` 
#### 5. Команда чтения файлов `text`
Аналог команды `cat`, но разархивирует архивы:
```bash
hdfs dfs -cat /dir/file.gz -- непонятный текст
hdfs dfs -text /dir/file.gz -- понятный текст
```
Если файл не заархивирован, то работа команд `text` и `cat` будет одинакова.
#### 6. Команда чтения файлов `tail`
Выводит последние строчки файла:
```bash
hdfs dfs -cat /dir/file.txt | tail -- плохо
hdfs dfs -tail /dir/file.txt -- хорошо
```
В первом случае читается весь файл и только потом от него отрезаются последние строчки для вывода. Для большого файла может потребоваться на чтение много времени -- прочитать все блоки файла со всех серверов. Только с последнего блока вывести последние строки. 
Во втором случае нет лишних действий, будут выведены последние строчки из последнего блока.

Полезна для просмотра, например, логов. 
#### 7. Копирование данных в `shell`
`cp` -- копирование файла из одного места в другое. Годится только для небольших файлов!
```bash
hdfs dfs -cp /dir/file1 /otherDir/file2
```
Копирует файл из одной директории в другую. Т.к. файл состоит из блоков, то каждый блок копируется на новое место. Если файл большой и состоит из многих блоков, то копирование такого файла будет выполняться долго.
Разумно копировать небольшие файлы, иначе для больших файлов потребуется много времени. 

`distcp` -- копирование больших файлов или множества файлов.
```bash
hdfs distcp /dir/file1 /otherDir/file2
```
это команда не часть команды `dfs`. При использовании команды `distcp` блоки файла копируются параллельно и независимо друг от друга. Файл копируется быстро. Для больших файлов.
`mv` -- перемещение файла из одного места в другое
```bash
hdfs dfs -mv/dir/file1 /otherDir
```
Физически перемещение данных не происходит. Указание Namenode, что файл теперь будет храниться в другой директории.

`put`, `copyFromLocal` -- копирование локального файла в директорию HDFS  
```bash
hdfs dfs -put localfile /dir/file
```

`get`, `copyToLocal` -- копирование файла из HDFS  в локальную файловую систему
```bash
hdfs dfs -get /dir/file localfile 
```
#### 8. Команда удаления в `shell`
`rm` -- удаляет файл в корзину. При случайном удалении большого файла его очень трудно восстановить. Поэтому файл сначала помещается в корзину. Корзина -- специальная для каждого пользователя директория. Файлы из нее можно удалить или скопировать на прежнее место. Автоматически очистка корзины задана в параметрах HDFS. Если нужно освободить место в HDFS, то можно удалить файл из корзины.
```bash
hdfs dfs -rm /dir/file -- удалить файл в корзину
hdfs dfs -rm -skipTrash /dir/file -- удалить файл без помещения в корзину
hdfs dfs -rm -r /dir -- удалить рекурсивно всю директорию (поддиректории)
```
#### 9. Команда выведения статистики в `shell`
`du` -- размер файла или директории в байтах
`du -h` -- размер файла или директории в удобно-читаемом формате
```bash
hdfs dfs -du -h /dir 
```
В HDFS файлы большие, поэтому удобнее использовать ключ `-h`.

## Права доступа в HDFS
* ограничения на уровне файла/директории
-- сходство с моделью прав в POSIX
-- `Read (r)`, `Write (w)`, `Execute (x)`
-- Разделяется на пользователя, группу и всех остальных
* Права пользователя определяются исходя из прав той ОС, где он запускает клиентское приложение.

У файлов есть владелец и группа, которой он принадлежит. 